<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çˆ±å°”å…°è·¯è€ƒè‹±è¯­å­¦ä¹ ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #5a67d8;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #718096;
            font-size: 1.1em;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 15px 30px;
            background: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .mode-btn.active {
            background: #5a67d8;
            color: white;
        }

        .content-area {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .category-tabs {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
            margin-bottom: 20px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: #cbd5e0 #f7fafc;
        }

        .category-tabs::-webkit-scrollbar {
            height: 6px;
        }

        .category-tabs::-webkit-scrollbar-track {
            background: #f7fafc;
            border-radius: 3px;
        }

        .category-tabs::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 3px;
        }

        .category-tab {
            flex-shrink: 0;
            padding: 12px 24px;
            background: #f7fafc;
            border: 2px solid transparent;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            color: #4a5568;
        }

        .category-tab:hover {
            background: #e2e8f0;
            transform: translateY(-2px);
        }

        .category-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .category-tab-icon {
            font-size: 1.3em;
        }

        .category-tab-title {
            font-size: 1em;
        }

        .category-tab-count {
            font-size: 0.85em;
            opacity: 0.8;
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 12px;
            margin-left: 4px;
        }

        .command-list {
            display: none;
        }

        .command-list.active {
            display: block;
        }

        .command-item {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
            transition: all 0.3s ease;
        }

        .command-item:hover {
            background: #edf2f7;
            transform: translateX(5px);
        }

        .command-type {
            display: inline-block;
            padding: 5px 15px;
            background: #5a67d8;
            color: white;
            border-radius: 20px;
            font-size: 0.8em;
            margin-bottom: 10px;
        }

        .command-english {
            font-size: 1.1em;
            font-weight: 500;
            margin-bottom: 10px;
            color: #2d3748;
        }

        .command-chinese {
            color: #718096;
            line-height: 1.6;
        }

        .audio-controls {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 10px;
        }

        .audio-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: #5a67d8;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }

        .audio-btn:hover {
            background: #4c51bf;
            transform: scale(1.1);
        }

        .audio-btn.playing {
            background: #48bb78;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(72, 187, 120, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(72, 187, 120, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(72, 187, 120, 0);
            }
        }

        .quiz-area {
            display: none;
            text-align: center;
        }

        .quiz-question {
            font-size: 1.5em;
            margin-bottom: 30px;
            color: #2d3748;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .quiz-option {
            padding: 20px;
            background: #f7fafc;
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            background: #edf2f7;
            border-color: #5a67d8;
        }

        .quiz-option.correct {
            background: #c6f6d5;
            border-color: #48bb78;
        }

        .quiz-option.incorrect {
            background: #fed7d7;
            border-color: #f56565;
        }

        .quiz-score {
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #5a67d8;
        }

        .quiz-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .quiz-btn {
            padding: 12px 30px;
            background: #5a67d8;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-btn:hover {
            background: #4c51bf;
            transform: translateY(-2px);
        }

        .speed-control {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            border-radius: 50px;
            padding: 10px 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .speed-label {
            font-size: 0.9em;
            color: #718096;
        }

        .speed-select {
            padding: 5px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            background: white;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .category-tabs {
                gap: 8px;
                padding: 8px 0;
            }
            
            .category-tab {
                padding: 10px 16px;
                font-size: 0.9em;
            }
            
            .category-tab-icon {
                font-size: 1.1em;
            }
            
            .quiz-options {
                grid-template-columns: 1fr;
            }
            
            .command-item {
                padding-right: 60px;
            }
            
            .audio-controls {
                flex-direction: column;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸš— çˆ±å°”å…°è·¯è€ƒè‹±è¯­å­¦ä¹ ç³»ç»Ÿ</h1>
            <p class="subtitle">æŒæ¡å®˜æ–¹å£ä»¤ï¼Œè½»æ¾é€šè¿‡è·¯è€ƒ</p>
            <div id="voice-status" style="margin-top: 10px; font-size: 0.9em; color: #718096;"></div>
        </header>

        <div class="mode-selector">
            <button class="mode-btn active" onclick="showMode('learn')">
                ğŸ“š å­¦ä¹ æ¨¡å¼
            </button>
            <button class="mode-btn" onclick="showMode('quiz-cn-en')">
                ğŸ¯ ä¸­è¯‘è‹±æµ‹éªŒ
            </button>
            <button class="mode-btn" onclick="showMode('quiz-en-cn')">
                ğŸ¯ è‹±è¯‘ä¸­æµ‹éªŒ
            </button>
        </div>

        <div class="content-area">
            <!-- å­¦ä¹ æ¨¡å¼ -->
            <div id="learn-mode" class="learn-area">
                <div class="category-tabs" id="categoryTabs"></div>
                <div id="commandContent"></div>
            </div>

            <!-- æµ‹éªŒæ¨¡å¼ -->
            <div id="quiz-mode" class="quiz-area">
                <div class="quiz-score" id="quizScore">å¾—åˆ†: 0 / 0</div>
                <div class="quiz-question" id="quizQuestion"></div>
                <div class="quiz-options" id="quizOptions"></div>
            </div>
        </div>

        <div class="speed-control">
            <span class="speed-label">è¯­é€Ÿ:</span>
            <select class="speed-select" id="speechRate" onchange="updateSpeechRate()">
                <option value="0.8">æ…¢é€Ÿ</option>
                <option value="1" selected>æ­£å¸¸</option>
                <option value="1.2">å¿«é€Ÿ</option>
            </select>
        </div>
    </div>

    <script>
        // æ•°æ®ç»“æ„
        const categories = [
            {
                id: 'startup',
                icon: 'ğŸ”‘',
                title: 'å¯åŠ¨',
                commands: [
                    {
                        english: 'Please start up the engine.',
                        chinese: 'è¯·å¯åŠ¨å¼•æ“ã€‚'
                    },
                    {
                        english: 'Now, you should drive in your normal manner. I will tell you in good time when to turn left or right, otherwise you follow the course of the road. If you have any doubts about my directions, ask me to repeat or clarify them. You may start when you are ready.',
                        chinese: 'å®˜æ–¹å£ä»¤ï¼šç°åœ¨è¯·ä»¥æ­£å¸¸æ–¹å¼é©¾é©¶ã€‚æˆ‘ä¼šæå‰å‘Šè¯‰ä½ ä»€ä¹ˆæ—¶å€™å·¦è½¬æˆ–å³è½¬ï¼Œå¦åˆ™è¯·æ²¿è·¯è¡Œé©¶ã€‚å¦‚æœå¯¹æŒ‡ä»¤æœ‰ç–‘é—®ï¼Œå¯ä»¥è®©æˆ‘é‡å¤æˆ–è§£é‡Šã€‚å‡†å¤‡å¥½åå°±å¯ä»¥å‡ºå‘ã€‚'
                    }
                ]
            },
            {
                id: 'basic',
                icon: 'ğŸ›£ï¸',
                title: 'é“è·¯åŸºæœ¬è¡Œé©¶',
                commands: [
                    {
                        english: 'At the next junction, turn right.',
                        chinese: 'åœ¨ä¸‹ä¸€ä¸ªè·¯å£å³è½¬ã€‚'
                    },
                    {
                        english: 'At the traffic light, turn left.',
                        chinese: 'åœ¨çº¢ç»¿ç¯å¤„å·¦è½¬ã€‚'
                    },
                    {
                        english: 'Take the next road on the right, please.',
                        chinese: 'è¯·åœ¨ä¸‹ä¸€ä¸ªå²”è·¯å³è½¬ã€‚'
                    },
                    {
                        english: 'At the end of the road, turn left.',
                        chinese: 'åœ¨è¿™æ¡è·¯çš„å°½å¤´å·¦è½¬ã€‚'
                    },
                    {
                        english: 'Take the next right.',
                        chinese: 'åœ¨ä¸‹ä¸€ä¸ªè·¯å£å³è½¬ã€‚'
                    },
                    {
                        english: 'Take the next left.',
                        chinese: 'åœ¨ä¸‹ä¸€ä¸ªè·¯å£å·¦è½¬ã€‚'
                    },
                    {
                        english: 'Go straight ahead.',
                        chinese: 'ç›´è¡Œã€‚'
                    },
                    {
                        english: 'Keep going straight ahead.',
                        chinese: 'ç»§ç»­ç›´è¡Œã€‚'
                    }
                ]
            },
            {
                id: 'roundabout',
                icon: 'ğŸ”„',
                title: 'ç¯å²›è¡Œé©¶',
                commands: [
                    {
                        english: 'At the roundabout, take the first exit.',
                        chinese: 'åœ¨ç¯å²›èµ°ç¬¬ä¸€ä¸ªå‡ºå£ã€‚'
                    },
                    {
                        english: 'Take the first exit at the roundabout.',
                        chinese: 'åœ¨ç¯å²›èµ°ç¬¬ä¸€ä¸ªå‡ºå£ã€‚'
                    },
                    {
                        english: 'At the roundabout, turn left.',
                        chinese: 'åœ¨ç¯å²›å·¦è½¬ã€‚'
                    },
                    {
                        english: 'At the roundabout, take the second exit.',
                        chinese: 'åœ¨ç¯å²›èµ°ç¬¬äºŒä¸ªå‡ºå£ã€‚'
                    },
                    {
                        english: 'Take the second exit at the roundabout.',
                        chinese: 'åœ¨ç¯å²›èµ°ç¬¬äºŒä¸ªå‡ºå£ã€‚'
                    },
                    {
                        english: 'Go straight ahead at the roundabout.',
                        chinese: 'åœ¨ç¯å²›ç›´è¡Œã€‚'
                    },
                    {
                        english: 'At the roundabout, take the third exit.',
                        chinese: 'åœ¨ç¯å²›èµ°ç¬¬ä¸‰ä¸ªå‡ºå£ã€‚'
                    },
                    {
                        english: 'At the roundabout, take the third exit on the right.',
                        chinese: 'åœ¨ç¯å²›çš„å³ä¾§èµ°ç¬¬ä¸‰ä¸ªå‡ºå£ã€‚'
                    },
                    {
                        english: 'Take the third exit at the roundabout.',
                        chinese: 'åœ¨ç¯å²›èµ°ç¬¬ä¸‰ä¸ªå‡ºå£ã€‚'
                    },
                    {
                        english: 'At the roundabout, turn right.',
                        chinese: 'åœ¨ç¯å²›å³è½¬ã€‚'
                    }
                ]
            },
            {
                id: 'uturn',
                icon: 'â†©ï¸',
                title: 'æ‰å¤´',
                commands: [
                    {
                        english: 'I would like you to turn your car around on the road to face the opposite way. You may go over and back more than once if necessary. You may start when you are ready.',
                        chinese: 'å®˜æ–¹å£ä»¤ï¼šè¯·å°†è½¦åœ¨é“è·¯ä¸Šæ‰å¤´è‡³ç›¸åæ–¹å‘ã€‚å¦‚æœ‰éœ€è¦å¯å‰åå¤šæ¬¡è°ƒæ•´ã€‚å‡†å¤‡å¥½åå°±å¼€å§‹ã€‚'
                    },
                    {
                        english: 'Turn around your car and go back to where we came from.',
                        chinese: 'è¯·å°†è½¦æ‰å¤´å¹¶åŸè·¯è¿”å›ã€‚'
                    },
                    {
                        english: "Let's do a turnabout.",
                        chinese: 'æˆ‘ä»¬æ¥åšä¸ªæ‰å¤´ç»ƒä¹ ã€‚'
                    },
                    {
                        english: "Let's do a turnaround.",
                        chinese: 'æˆ‘ä»¬æ¥åšä¸ªæ‰å¤´ç»ƒä¹ ã€‚'
                    },
                    {
                        english: "Let's do a three-point turn.",
                        chinese: 'æˆ‘ä»¬æ¥åšä¸€æ¬¡ä¸‰ç‚¹æ‰å¤´ã€‚'
                    }
                ]
            },
            {
                id: 'reverse',
                icon: 'â¬…ï¸',
                title: 'å€’è½¦',
                commands: [
                    {
                        english: 'This road on the left is the one I want you to reverse your vehicle into. Will you drive past it and stop on the left, and I will give you further directions.',
                        chinese: 'å®˜æ–¹å£ä»¤ï¼šæˆ‘å¸Œæœ›ä½ å€’è½¦è¿›å…¥å·¦è¾¹è¿™æ¡è·¯ã€‚è¯·å…ˆé©¶è¿‡è·¯å£ç„¶åé å·¦åœè½¦ï¼Œæˆ‘ä¼šå†ç»™ä½ æŒ‡ç¤ºã€‚'
                    },
                    {
                        english: "Reverse into this road on the left. You should continue reversing, while it is safe to do so, keeping reasonably close to the left. I'll tell you when you have gone back far enough; you may start when you are ready.",
                        chinese: 'å®˜æ–¹å£ä»¤ï¼šè¯·æŠŠè½¦å€’è¿›å·¦è¾¹è¿™æ¡è·¯ï¼Œåœ¨å®‰å…¨çš„æƒ…å†µä¸‹ç»§ç»­å€’è½¦ï¼Œå°½é‡é è¿‘å·¦ä¾§ã€‚å‡†å¤‡å¥½åå°±å¼€å§‹ï¼Œå€’è½¦åˆ°äº†è¶³å¤Ÿæ—¶ï¼Œæˆ‘ä¼šå‘Šè¯‰ä½ ã€‚'
                    },
                    {
                        english: 'Reverse around the corner.',
                        chinese: 'åœ¨è½¬è§’å¤„å€’è½¦ã€‚'
                    },
                    {
                        english: 'Reverse around the corner into the road on the left.',
                        chinese: 'æ²¿è½¬è§’å€’è½¦è¿›å…¥å·¦ä¾§é“è·¯ã€‚'
                    },
                    {
                        english: 'Reverse into the next road on the left.',
                        chinese: 'å€’è½¦è¿›å…¥ä¸‹ä¸€ä¸ªå·¦è¾¹çš„è·¯å£ã€‚'
                    }
                ]
            },
            {
                id: 'parking',
                icon: 'ğŸ…¿ï¸',
                title: 'é è¾¹åœè½¦ä¸èµ·æ­¥',
                commands: [
                    {
                        english: 'Pull up on the left in a safe place.',
                        chinese: 'è¯·åœ¨å®‰å…¨çš„ä½ç½®é å·¦åœè½¦ã€‚'
                    },
                    {
                        english: 'Pull up on the left, please.',
                        chinese: 'è¯·é å·¦åœè½¦ã€‚'
                    },
                    {
                        english: 'Please move off.',
                        chinese: 'è¯·èµ·æ­¥ã€‚'
                    },
                    {
                        english: "Move off when it's safe.",
                        chinese: 'å®‰å…¨æ—¶è¯·èµ·æ­¥ã€‚'
                    },
                    {
                        english: 'Drive on when you are ready.',
                        chinese: 'å‡†å¤‡å¥½æ—¶è¯·èµ·æ­¥è¡Œé©¶ã€‚'
                    },
                    {
                        english: "When it's safe, drive on.",
                        chinese: 'å®‰å…¨æ—¶è¯·èµ·æ­¥è¡Œé©¶ã€‚'
                    },
                    {
                        english: 'Stop and move off again.',
                        chinese: 'åœä¸€ä¸‹ç„¶åå†èµ·æ­¥ï¼ˆæ¨¡æ‹Ÿä¸´æ—¶åœè½¦å†å¼€ï¼‰ã€‚'
                    }
                ]
            },
            {
                id: 'finish',
                icon: 'ğŸ',
                title: 'ç»“æŸå‰åœè½¦',
                commands: [
                    {
                        english: 'Please find a suitable place and park.',
                        chinese: 'è¯·æ‰¾ä¸€ä¸ªåˆé€‚çš„ä½ç½®åœè½¦ã€‚'
                    }
                ]
            }
        ];

        // å…¨å±€å˜é‡
        let currentMode = 'learn';
        let currentCategory = null;
        let quizMode = '';
        let quizQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let totalQuestions = 0;
        let speechRate = 1;
        let wrongAnswers = [];  // å­˜å‚¨é”™é¢˜

        // åˆå§‹åŒ–
        function init() {
            renderCategoryTabs();
            // é»˜è®¤æ˜¾ç¤ºç¬¬ä¸€ä¸ªåˆ†ç±»
            selectCategory(categories[0].id);
            
            // åˆå§‹åŒ–è¯­éŸ³
            if (window.speechSynthesis) {
                // åŠ è½½è¯­éŸ³åˆ—è¡¨
                const loadVoices = () => {
                    const voices = speechSynthesis.getVoices();
                    if (voices.length > 0) {
                        console.log('å¯ç”¨è¯­éŸ³æ•°é‡:', voices.length);
                        updateVoiceStatus();
                    }
                };
                
                loadVoices();
                if (speechSynthesis.onvoiceschanged !== undefined) {
                    speechSynthesis.onvoiceschanged = loadVoices;
                }
            }
        }

        // æ›´æ–°è¯­éŸ³çŠ¶æ€æ˜¾ç¤º
        function updateVoiceStatus() {
            const statusEl = document.getElementById('voice-status');
            const voices = speechSynthesis.getVoices();
            const englishVoices = voices.filter(v => v.lang.includes('en'));
            const premiumVoices = englishVoices.filter(v => 
                v.name.includes('Google') || 
                v.name.includes('Microsoft') || 
                v.name.includes('Premium') || 
                v.name.includes('Natural')
            );
            
            if (premiumVoices.length > 0) {
                statusEl.textContent = `âœ… ä½¿ç”¨é«˜è´¨é‡è¯­éŸ³: ${premiumVoices[0].name}`;
                statusEl.style.color = '#48bb78';
            } else if (englishVoices.length > 0) {
                statusEl.textContent = `ğŸ”Š ä½¿ç”¨ç³»ç»Ÿè¯­éŸ³: ${englishVoices[0].name}`;
                statusEl.style.color = '#4299e1';
            } else {
                statusEl.textContent = 'âš ï¸ æœªæ£€æµ‹åˆ°è‹±è¯­è¯­éŸ³';
                statusEl.style.color = '#e53e3e';
            }
        }

        // æ˜¾ç¤ºæµ‹éªŒç»“æœ
        function showQuizResult() {
            const accuracy = totalQuestions > 0 ? Math.round(score/totalQuestions*100) : 0;
            let resultHTML = `
                <div style="text-align: center; padding: 20px;">
                    <h2 style="color: #5a67d8; margin-bottom: 20px;">æµ‹éªŒå®Œæˆï¼</h2>
                    <div style="font-size: 3em; margin-bottom: 20px;">
                        ${accuracy >= 80 ? 'ğŸ‰' : accuracy >= 60 ? 'ğŸ‘' : 'ğŸ’ª'}
                    </div>
                    <p style="font-size: 1.5em; margin-bottom: 10px;">
                        å¾—åˆ†: <strong>${score} / ${totalQuestions}</strong>
                    </p>
                    <p style="font-size: 1.3em; margin-bottom: 30px;">
                        æ­£ç¡®ç‡: <strong>${accuracy}%</strong>
                    </p>
            `;
            
            if (wrongAnswers.length > 0) {
                resultHTML += `
                    <div style="margin-bottom: 20px;">
                        <button class="quiz-btn" onclick="showWrongAnswers()">æŸ¥çœ‹é”™é¢˜ (${wrongAnswers.length})</button>
                    </div>
                `;
            }
            
            resultHTML += `
                    <div>
                        <button class="quiz-btn" onclick="resetQuiz()">é‡æ–°å¼€å§‹</button>
                        <button class="quiz-btn" onclick="showMode('learn')">è¿”å›å­¦ä¹ </button>
                    </div>
                </div>
            `;
            
            document.getElementById('quizQuestion').innerHTML = resultHTML;
            document.getElementById('quizOptions').innerHTML = '';
        }
        
        // æ˜¾ç¤ºé”™é¢˜å›é¡¾
        function showWrongAnswers() {
            let wrongAnswersHTML = `
                <div style="text-align: left;">
                    <h2 style="color: #5a67d8; margin-bottom: 20px; text-align: center;">é”™é¢˜å›é¡¾</h2>
            `;
            
            wrongAnswers.forEach((item, index) => {
                const isChineseToEnglish = item.mode === 'quiz-cn-en';
                wrongAnswersHTML += `
                    <div style="background: #f7fafc; padding: 20px; margin-bottom: 15px; border-radius: 10px; border-left: 4px solid #e53e3e;">
                        <div style="font-weight: bold; margin-bottom: 10px; color: #2d3748;">
                            ${index + 1}. ${isChineseToEnglish ? 'ä¸­è¯‘è‹±' : 'è‹±è¯‘ä¸­'}
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>é¢˜ç›®ï¼š</strong>${isChineseToEnglish ? item.question.chinese : item.question.english}
                        </div>
                        <div style="margin-bottom: 10px; color: #e53e3e;">
                            <strong>ä½ çš„ç­”æ¡ˆï¼š</strong>${item.userAnswer} âŒ
                        </div>
                        <div style="color: #48bb78;">
                            <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong><br>
                            ${item.correctAnswers.map(ans => `â€¢ ${ans}`).join('<br>')}
                        </div>
                    </div>
                `;
            });
            
            wrongAnswersHTML += `
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="quiz-btn" onclick="showQuizResult()">è¿”å›ç»“æœ</button>
                        <button class="quiz-btn" onclick="resetQuiz()">é‡æ–°å¼€å§‹</button>
                    </div>
                </div>
            `;
            
            document.getElementById('quizQuestion').innerHTML = wrongAnswersHTML;
            document.getElementById('quizOptions').innerHTML = '';
        }

        // æ¸²æŸ“åˆ†ç±»æ ‡ç­¾
        function renderCategoryTabs() {
            const tabsContainer = document.getElementById('categoryTabs');
            tabsContainer.innerHTML = categories.map(cat => `
                <div class="category-tab" id="tab-${cat.id}" onclick="selectCategory('${cat.id}')">
                    <span class="category-tab-icon">${cat.icon}</span>
                    <span class="category-tab-title">${cat.title}</span>
                    <span class="category-tab-count">${cat.commands.length}</span>
                </div>
            `).join('');
        }

        // æ¸²æŸ“æŒ‡ä»¤å†…å®¹
        function renderCommandContent(categoryId) {
            const category = categories.find(cat => cat.id === categoryId);
            if (!category) return;

            const container = document.getElementById('commandContent');
            container.innerHTML = `
                <h2 style="margin-bottom: 20px; color: #5a67d8; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.5em;">${category.icon}</span>
                    ${category.title}
                </h2>
                ${category.commands.map((cmd, index) => `
                    <div class="command-item">
                        <div class="command-english">${cmd.english}</div>
                        <div class="command-chinese">${cmd.chinese}</div>
                        <div class="audio-controls">
                            <button class="audio-btn" onclick="playAudio('${category.id}-${index}', '${encodeURIComponent(cmd.english)}')">
                                ğŸ”Š
                            </button>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        // é€‰æ‹©åˆ†ç±»
        function selectCategory(catId) {
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(`tab-${catId}`).classList.add('active');

            // æ¸²æŸ“å¯¹åº”çš„å†…å®¹
            renderCommandContent(catId);

            currentCategory = catId;
        }

        // æ’­æ”¾éŸ³é¢‘
        function playAudio(id, text) {
            const btn = event.target;
            
            // å¦‚æœæ­£åœ¨æ’­æ”¾ï¼Œå…ˆåœæ­¢
            if (btn.classList.contains('playing')) {
                speechSynthesis.cancel();
                btn.classList.remove('playing');
                return;
            }
            
            btn.classList.add('playing');
            const decodedText = decodeURIComponent(text);
            
            const utterance = new SpeechSynthesisUtterance(decodedText);
            
            // è·å–æ‰€æœ‰å¯ç”¨è¯­éŸ³å¹¶é€‰æ‹©æœ€ä¼˜è´¨çš„
            const voices = speechSynthesis.getVoices();
            
            // ä¼˜å…ˆçº§æ’åºï¼šå¯»æ‰¾æœ€ä¼˜è´¨çš„è‹±è¯­è¯­éŸ³
            const voicePriority = [
                // æœ€é«˜ä¼˜å…ˆçº§ï¼šGoogle çš„è‹±è¯­è¯­éŸ³
                voice => voice.name.includes('Google') && voice.lang.includes('en'),
                // æ¬¡ä¼˜å…ˆçº§ï¼šMicrosoft çš„è‹±è¯­è¯­éŸ³
                voice => voice.name.includes('Microsoft') && voice.lang.includes('en'),
                // ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šæ ‡è®°ä¸º Premium æˆ– Natural çš„è‹±è¯­è¯­éŸ³
                voice => (voice.name.includes('Premium') || voice.name.includes('Natural')) && voice.lang.includes('en'),
                // ç¬¬å››ä¼˜å…ˆçº§ï¼šè‹±å›½æˆ–çˆ±å°”å…°è‹±è¯­
                voice => voice.lang === 'en-GB' || voice.lang === 'en-IE',
                // ç¬¬äº”ä¼˜å…ˆçº§ï¼šä»»ä½•è‹±è¯­è¯­éŸ³
                voice => voice.lang.startsWith('en')
            ];
            
            let selectedVoice = null;
            for (const criterion of voicePriority) {
                const matchingVoices = voices.filter(criterion);
                if (matchingVoices.length > 0) {
                    selectedVoice = matchingVoices[0];
                    break;
                }
            }
            
            if (selectedVoice) {
                utterance.voice = selectedVoice;
                console.log('ä½¿ç”¨è¯­éŸ³:', selectedVoice.name);
            }
            
            utterance.rate = speechRate;
            utterance.pitch = 1;
            utterance.volume = 1;
            
            utterance.onend = () => {
                btn.classList.remove('playing');
            };
            
            utterance.onerror = (event) => {
                console.error('è¯­éŸ³æ’­æ”¾é”™è¯¯:', event);
                btn.classList.remove('playing');
            };
            
            speechSynthesis.speak(utterance);
        }

        // åœæ­¢æ‰€æœ‰éŸ³é¢‘
        function stopAllAudio() {
            speechSynthesis.cancel();
            const playingButtons = document.querySelectorAll('.audio-btn.playing');
            playingButtons.forEach(btn => btn.classList.remove('playing'));
        }

        // æ›´æ–°è¯­é€Ÿ
        function updateSpeechRate() {
            speechRate = parseFloat(document.getElementById('speechRate').value);
        }

        // åˆ‡æ¢æ¨¡å¼
        function showMode(mode) {
            currentMode = mode;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // æ˜¾ç¤ºå¯¹åº”å†…å®¹
            document.getElementById('learn-mode').style.display = 'none';
            document.getElementById('quiz-mode').style.display = 'none';
            
            if (mode === 'learn') {
                document.getElementById('learn-mode').style.display = 'block';
            } else if (mode.startsWith('quiz')) {
                document.getElementById('quiz-mode').style.display = 'block';
                quizMode = mode;
                startQuiz();
            }
        }

        // å¼€å§‹æµ‹éªŒ
        function startQuiz() {
            // æ”¶é›†æ‰€æœ‰å‘½ä»¤
            quizQuestions = [];
            
            if (quizMode === 'quiz-cn-en') {
                // ä¸­è¯‘è‹±ï¼šéœ€è¦å»é‡ä¸­æ–‡
                const uniqueChinese = new Map();
                categories.forEach(cat => {
                    cat.commands.forEach(cmd => {
                        if (!uniqueChinese.has(cmd.chinese)) {
                            uniqueChinese.set(cmd.chinese, {
                                english: cmd.english,
                                chinese: cmd.chinese,
                                category: cat.title
                            });
                        }
                    });
                });
                quizQuestions = Array.from(uniqueChinese.values());
            } else {
                // è‹±è¯‘ä¸­ï¼šä¿ç•™æ‰€æœ‰ä¸åŒçš„è‹±æ–‡å¥å­
                categories.forEach(cat => {
                    cat.commands.forEach(cmd => {
                        quizQuestions.push({
                            english: cmd.english,
                            chinese: cmd.chinese,
                            category: cat.title
                        });
                    });
                });
            }
            
            // éšæœºæ‰“ä¹±
            quizQuestions.sort(() => Math.random() - 0.5);
            
            // é‡ç½®çŠ¶æ€
            currentQuestionIndex = 0;
            score = 0;
            totalQuestions = 0;
            
            // æ˜¾ç¤ºç¬¬ä¸€é¢˜
            showQuestion();
        }

        // æ˜¾ç¤ºé¢˜ç›®
        function showQuestion() {
            if (currentQuestionIndex >= quizQuestions.length) {
                // æµ‹éªŒç»“æŸ
                showQuizResult();
                return;
            }
            
            const question = quizQuestions[currentQuestionIndex];
            const isChineseToEnglish = quizMode === 'quiz-cn-en';
            
            // æ˜¾ç¤ºé¢˜ç›®
            document.getElementById('quizQuestion').innerHTML = 
                isChineseToEnglish ? 
                `<strong>è¯·é€‰æ‹©æ­£ç¡®çš„è‹±æ–‡ç¿»è¯‘:</strong><br>${question.chinese}` :
                `<strong>è¯·é€‰æ‹©æ­£ç¡®çš„ä¸­æ–‡ç¿»è¯‘:</strong><br>${question.english}`;
            
            // ç”Ÿæˆé€‰é¡¹
            let options = [];
            
            if (isChineseToEnglish) {
                // ä¸­è¯‘è‹±ï¼šæ‰¾å‡ºæ‰€æœ‰è¯¥ä¸­æ–‡å¯¹åº”çš„è‹±æ–‡
                const correctAnswers = quizQuestions
                    .filter(q => q.chinese === question.chinese)
                    .map(q => q.english);
                
                // æ·»åŠ æ‰€æœ‰æ­£ç¡®ç­”æ¡ˆ
                options.push(...correctAnswers);
                
                // æ·»åŠ å…¶ä»–é”™è¯¯é€‰é¡¹ï¼Œç¡®ä¿ä¸é‡å¤
                const wrongOptions = quizQuestions
                    .filter(q => q.chinese !== question.chinese)
                    .map(q => q.english)
                    .filter(eng => !options.includes(eng))
                    .sort(() => Math.random() - 0.5);
                
                // è¡¥å……åˆ°4ä¸ªé€‰é¡¹
                while (options.length < 4 && wrongOptions.length > 0) {
                    options.push(wrongOptions.shift());
                }
            } else {
                // è‹±è¯‘ä¸­ï¼šç¡®ä¿åŒ…å«æ­£ç¡®ç­”æ¡ˆ
                const correctAnswer = question.chinese;
                options.push(correctAnswer);
                
                // æŸ¥æ‰¾æ‰€æœ‰å¯èƒ½çš„åŒä¹‰ç­”æ¡ˆ
                const allCorrectAnswers = categories
                    .flatMap(cat => cat.commands)
                    .filter(cmd => cmd.english === question.english)
                    .map(cmd => cmd.chinese);
                
                // æ·»åŠ å…¶ä»–åŒä¹‰ç­”æ¡ˆï¼ˆå¦‚æœæœ‰ï¼‰
                allCorrectAnswers.forEach(answer => {
                    if (!options.includes(answer)) {
                        options.push(answer);
                    }
                });
                
                // æ·»åŠ é”™è¯¯é€‰é¡¹
                const wrongOptions = categories
                    .flatMap(cat => cat.commands)
                    .filter(cmd => cmd.english !== question.english)
                    .map(cmd => cmd.chinese)
                    .filter(chi => !options.includes(chi))
                    .sort(() => Math.random() - 0.5);
                
                // è¡¥å……åˆ°4ä¸ªé€‰é¡¹
                while (options.length < 4 && wrongOptions.length > 0) {
                    const wrongOption = wrongOptions.shift();
                    if (!options.includes(wrongOption)) {
                        options.push(wrongOption);
                    }
                }
            }
            
            // æ‰“ä¹±é€‰é¡¹é¡ºåº
            options.sort(() => Math.random() - 0.5);
            
            // è·å–ç¬¬ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆï¼ˆç”¨äºå…¼å®¹ï¼‰
            const firstCorrectAnswer = isChineseToEnglish ? 
                quizQuestions.find(q => q.chinese === question.chinese).english :
                question.chinese;
            
            // æ¸²æŸ“é€‰é¡¹
            document.getElementById('quizOptions').innerHTML = options.map((opt, index) => `
                <div class="quiz-option" data-index="${index}">
                    ${opt}
                </div>
            `).join('');
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
            document.querySelectorAll('.quiz-option').forEach((optElement, idx) => {
                optElement.onclick = () => checkAnswer(idx, firstCorrectAnswer);
            });
            
            // å¦‚æœæ˜¯è‹±è¯‘ä¸­ï¼Œæ’­æ”¾éŸ³é¢‘
            if (!isChineseToEnglish) {
                // å…ˆåœæ­¢ä»»ä½•æ­£åœ¨æ’­æ”¾çš„éŸ³é¢‘
                speechSynthesis.cancel();
                
                setTimeout(() => {
                    const utterance = new SpeechSynthesisUtterance(question.english);
                    const voices = speechSynthesis.getVoices();
                    const englishVoices = voices.filter(v => v.lang.includes('en'));
                    if (englishVoices.length > 0) {
                        utterance.voice = englishVoices[0];
                    }
                    utterance.rate = speechRate;
                    speechSynthesis.speak(utterance);
                }, 500);
            }
        }

        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswer(index, correctAnswer) {
            const options = document.querySelectorAll('.quiz-option');
            const selectedOption = options[index];
            const selectedText = selectedOption.textContent.trim();
            
            totalQuestions++;
            
            // è·å–å½“å‰é¢˜ç›®
            const currentQuestion = quizQuestions[currentQuestionIndex];
            const isChineseToEnglish = quizMode === 'quiz-cn-en';
            
            let isCorrect = false;
            let allCorrectAnswers = [];
            
            if (isChineseToEnglish) {
                // ä¸­è¯‘è‹±ï¼šæŸ¥æ‰¾æ‰€æœ‰å…·æœ‰ç›¸åŒä¸­æ–‡çš„ç­”æ¡ˆ
                allCorrectAnswers = quizQuestions
                    .filter(q => q.chinese === currentQuestion.chinese)
                    .map(q => q.english);
                
                isCorrect = allCorrectAnswers.includes(selectedText);
                
                // æ ‡è®°æ‰€æœ‰æ­£ç¡®ç­”æ¡ˆ
                options.forEach(opt => {
                    const optText = opt.textContent.trim();
                    if (allCorrectAnswers.includes(optText)) {
                        opt.classList.add('correct');
                    } else if (opt === selectedOption && !isCorrect) {
                        opt.classList.add('incorrect');
                    }
                });
            } else {
                // è‹±è¯‘ä¸­ï¼šæŸ¥æ‰¾æ‰€æœ‰å…·æœ‰ç›¸åŒè‹±æ–‡çš„ç­”æ¡ˆ
                allCorrectAnswers = quizQuestions
                    .filter(q => q.english === currentQuestion.english)
                    .map(q => q.chinese);
                
                isCorrect = allCorrectAnswers.includes(selectedText);
                
                // æ ‡è®°æ‰€æœ‰æ­£ç¡®ç­”æ¡ˆ
                options.forEach(opt => {
                    const optText = opt.textContent.trim();
                    if (allCorrectAnswers.includes(optText)) {
                        opt.classList.add('correct');
                    } else if (opt === selectedOption && !isCorrect) {
                        opt.classList.add('incorrect');
                    }
                });
            }
            
            if (isCorrect) {
                score++;
            } else {
                // è®°å½•é”™é¢˜
                wrongAnswers.push({
                    question: currentQuestion,
                    userAnswer: selectedText,
                    correctAnswers: allCorrectAnswers,
                    mode: quizMode
                });
            }
            
            // ç¦ç”¨æ‰€æœ‰é€‰é¡¹
            options.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            // æ›´æ–°åˆ†æ•°
            document.getElementById('quizScore').textContent = `å¾—åˆ†: ${score} / ${totalQuestions}`;
            
            // æ ¹æ®ç­”é¢˜ç»“æœå†³å®šè·³è½¬æ—¶é—´
            const delay = isCorrect ? 200 : 2000;  // æ­£ç¡®200msï¼Œé”™è¯¯2ç§’
            setTimeout(() => {
                nextQuestion();
            }, delay);
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            // åœæ­¢å½“å‰éŸ³é¢‘
            speechSynthesis.cancel();
            currentQuestionIndex++;
            showQuestion();
        }

        // é‡ç½®æµ‹éªŒ
        function resetQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            totalQuestions = 0;
            wrongAnswers = [];  // æ¸…ç©ºé”™é¢˜è®°å½•
            document.getElementById('quizScore').textContent = 'å¾—åˆ†: 0 / 0';
            startQuiz();
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>